<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Système de gestion des livrets scolaires pour le Programme d'éducation intermédiaire (PEI) et le Programme du diplôme (DP) de l'IB">
    <meta name="keywords" content="livret scolaire, IB, PEI, DP, éducation, contributions">
    <title>Livret scolaire IB</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Livret scolaire</h1>
        <div class="header-buttons">
            <button id="generateWordButton" onclick="generateAllWordsInSection()" title="Générer les livrets Word pour tous les élèves">Générer Tous les Livrets (Word)</button>
            <button id="generateExcelButton" onclick="generateExcel()" style="background-color: #198754;" title="Générer un export Excel">Générer Excel (Section)</button>
        </div>
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar">
                <span class="progress-text" id="progressText">0%</span>
            </div>
        </div>
    </header>

    <main>
        <div class="select-container">
            <section id="step0">
                <h2>1. Choisir une Section</h2>
                <div class="section-buttons">
                    <button class="garçons" onclick="handleSectionChange('garçons')">Section des Garçons</button>
                    <button class="filles" onclick="handleSectionChange('filles')" style="background: linear-gradient(to right, #e83e8c, #c2185b);">Section des Filles</button>
                </div>
            </section>
            
            <section id="step1" style="display: none;">
                <h2>2. Choisir une Classe</h2>
                <select id="classSelector" onchange="handleClassChange(this.value)">
                    <option value="">-- Sélectionnez une Classe --</option>
                    <option value="PEI1">PEI1</option>
                    <option value="PEI2">PEI2</option>
                    <option value="PEI3">PEI3</option>
                    <option value="PEI4">PEI4</option>
                    <option value="PEI5">PEI5</option>
                    <option value="DP1">DP1</option>
                    <option value="DP2">DP2</option>
                </select>
            </section>
            
            <section id="step3" style="display: none;">
                <h2>3. Choisir un Élève</h2>
                <select id="studentSelector" onchange="handleStudentChange(this.value)">
                    <option value="">-- Sélectionnez un élève --</option>
                </select>
            </section>
        </div>

        <div id="studentInfoContainer" class="data-container" style="display: none">
            <h2>Informations Élève</h2>
            <div class="student-info">
                <div class="student-photo-birthdate-container">
                    <img id="studentPhotoPreview" style="display: none;" src="#" alt="Photo de l'élève">
                    <div class="birthdate-container">
                        <label for="studentBirthdate">Date de naissance:</label>
                        <input type="date" id="studentBirthdate" onchange="handleStudentBirthdateChange(this.value)" title="Date de naissance">
                    </div>
                </div>
                <div>
                    <label for="studentNameDisplay">Nom:</label>
                    <p id="studentNameDisplay"></p>
                </div>
                <div class="student-info-buttons">
                    <button onclick="showStudentData();" title="Voir toutes les contributions">Afficher Contributions</button>
                </div>
            </div>
            
            <section id="step2" style="display: none; margin-top: 20px; padding: 15px;">
                <h2>4. Choisir une Matière</h2>
                <select id="subjectSelector" onchange="handleSubjectChange(this.value)">
                    <option value="">-- Sélectionnez une matière --</option>
                </select>
            </section>
        </div>

        <div id="contributionEntrySections" style="display: none;">
            <section id="communicationTable">
                <h2>Critères Initiaux (Compétences Approche de l'Apprentissage)</h2>
                <p style="font-size: 0.9em; color: #6c757d;">
                    <span style="font-weight: bold;">E</span>: Excellent | 
                    <span style="font-weight: bold;">A</span>: Acquis | 
                    <span style="font-weight: bold;">PA</span>: Partiellement Acquis | 
                    <span style="font-weight: bold;">I</span>: Insuffisant
                </p>
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Communication</th>
                            <th>Collaboration</th>
                            <th>Autogestion</th>
                            <th>Recherche</th>
                            <th>Réflexion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>Évaluation</th>
                            <td><select onchange="handleCommunicationChange()"><option value=""></option><option>E</option><option>A</option><option>PA</option><option>I</option></select></td>
                            <td><select onchange="handleCommunicationChange()"><option value=""></option><option>E</option><option>A</option><option>PA</option><option>I</option></select></td>
                            <td><select onchange="handleCommunicationChange()"><option value=""></option><option>E</option><option>A</option><option>PA</option><option>I</option></select></td>
                            <td><select onchange="handleCommunicationChange()"><option value=""></option><option>E</option><option>A</option><option>PA</option><option>I</option></select></td>
                            <td><select onchange="handleCommunicationChange()"><option value=""></option><option>E</option><option>A</option><option>PA</option><option>I</option></select></td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <section id="criteriaTable">
                <h2>Critères d'Évaluation (Matière)</h2>
                <div style="margin-bottom: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 5px;">
                    <label style="margin-right: 15px;">
                        <strong>Nombre d'unités - Semestre 1:</strong>
                        <select id="unitsSem1Selector" onchange="handleUnitsChange()" style="margin-left: 5px; padding: 5px;">
                            <option value="1">1 unité (note directe)</option>
                            <option value="2">2 unités</option>
                            <option value="3">3 unités</option>
                            <option value="4">4 unités</option>
                            <option value="5">5 unités</option>
                        </select>
                    </label>
                    <label>
                        <strong>Nombre d'unités - Semestre 2:</strong>
                        <select id="unitsSem2Selector" onchange="handleUnitsChange()" style="margin-left: 5px; padding: 5px;">
                            <option value="1">1 unité (note directe)</option>
                            <option value="2">2 unités</option>
                            <option value="3">3 unités</option>
                            <option value="4">4 unités</option>
                            <option value="5">5 unités</option>
                        </select>
                    </label>
                </div>
                <table id="criteriaTableElement">
                    <thead id="criteriaTableHead">
                        <tr>
                            <th>Critères</th>
                            <th>Semestre 1 (/8)</th>
                            <th>Semestre 2 (/8)</th>
                            <th>Niveau Final (/8)</th>
                            <th>Seuil Total (/32)</th>
                            <th>Note Finale (/8)</th>
                        </tr>
                    </thead>
                    <tbody id="criteriaTableBody">
                        <tr data-criteria="A">
                            <td>A</td>
                            <td class="sem1-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td class="sem2-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td><input type="number" readonly tabindex="-1" class="final-level-input"></td>
                            <td rowspan="4"><input id="threshold" type="number" readonly tabindex="-1" style="background-color: #e9ecef;"></td>
                            <td rowspan="4"><input id="finalNote" type="number" readonly tabindex="-1" style="background-color: #e9ecef;"></td>
                        </tr>
                        <tr data-criteria="B">
                            <td>B</td>
                            <td class="sem1-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td class="sem2-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td><input type="number" readonly tabindex="-1" class="final-level-input"></td>
                        </tr>
                        <tr data-criteria="C">
                            <td>C</td>
                            <td class="sem1-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td class="sem2-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td><input type="number" readonly tabindex="-1" class="final-level-input"></td>
                        </tr>
                        <tr data-criteria="D">
                            <td>D</td>
                            <td class="sem1-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td class="sem2-cell"><input type="number" min="0" max="8" oninput="validateInput(this)"></td>
                            <td><input type="number" readonly tabindex="-1" class="final-level-input"></td>
                        </tr>
                    </tbody>
                </table>
                <h3>Commentaires</h3>
                <textarea id="teacherComment" rows="4" placeholder="Écrivez vos commentaires ici..." onchange="handleCommentChange(this.value)"></textarea>
                <h3>Nom de l'enseignant</h3>
                <input id="teacherName" placeholder="Entrez votre nom" onchange="handleTeacherNameChange(this.value)">
                <div style="text-align: right; margin-top: 20px;">
                    <button id="submitButton" onclick="submitForm()">Soumettre / Mettre à jour</button>
                </div>
            </section>
        </div>

        <div class="data-container" id="dataContainer"></div>
    </main>

    <script src="/script.js"></script>
    <script>
        // script.js charge toutes les fonctions et variables requises.
        // Ici, nous n'ajoutons que les handlers nécessaires pour les attributs HTML inline.
        window.handleSectionChange = handleSectionChange;
        window.handleClassChange = handleClassChange;
        window.handleStudentChange = handleStudentChange;
        window.handleSubjectChange = handleSubjectChange;
        window.handleCommunicationChange = handleCommunicationChange;
        window.handleTeacherNameChange = handleTeacherNameChange;
        window.handleStudentBirthdateChange = handleStudentBirthdateChange;
        window.handleUnitsChange = handleUnitsChange;
        window.validateInput = validateInput;
        window.submitForm = submitForm;
        window.showStudentData = showStudentData;
        window.toggleContributionDetails = toggleContributionDetails;
        window.editContribution = editContribution;
        window.deleteContribution = deleteContribution;
        window.generateAllWordsInSection = generateAllWordsInSection;
        window.generateExcel = generateExcel;

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Application prête.');
        });
    </script>
</body>
</html>
